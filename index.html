<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>iSHIP</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>iSHIP</h1>
    <p>Your fast, reliable delivery partner.</p>
  </header>

  <section>
    <h2>Request a Quote</h2>
    <form action="#" method="POST">
      <label>Pickup Address:</label><br />
      <input type="text" name="pickup" required /><br />
      <label>Drop-off Address:</label><br />
      <input type="text" name="dropoff" required /><br />
      <label>Package Weight (kg):</label><br />
      <input type="number" name="weight" step="0.1" required /><br />
      <button type="submit">Get Quote</button>
    </form>
  </section>

  <section>
    <h2>Track Your Parcel</h2>
    <form action="#" method="GET">
      <label>Tracking ID:</label><br />
      <input type="text" name="tracking_id" id="tracking_id" required /><br />
      <button type="button" onclick="trackPackage()">Track</button>
    </form>
    <div id="trackingResult" style="margin-top:10px;"></div>
  </section>

  <footer>
    <p>&copy; 2025 iSHIP</p>
  </footer>

  <!-- Hidden Admin Panel -->
  <div id="adminTrackingPanel" style="display:none; position: fixed; top: 10%; right: 10%; background: white; border: 1px solid #ccc; padding: 20px; z-index: 9999; box-shadow: 0 0 10px rgba(0,0,0,0.2);">
    <h2>Admin: Issue Tracking Number</h2>
    <form id="adminTrackingForm">
      <label>Pickup Address:</label><br />
      <input type="text" id="adminPickup" required /><br />
      <label>Drop-off Address:</label><br />
      <input type="text" id="adminDropoff" required /><br />
      <label>Package Weight (kg):</label><br />
      <input type="number" id="adminWeight" step="0.1" required /><br />
      <button type="submit">Create Tracking Number</button>
    </form>
    <div id="adminResponse" style="margin-top: 10px; color: green;"></div>
    <button onclick="document.getElementById('adminTrackingPanel').style.display='none'">Close</button>
  </div>

  <script>
    // Toggle admin panel on Ctrl+Shift+A
    document.addEventListener('keydown', function(e) {
      if (e.ctrlKey && e.shiftKey && e.code === 'KeyA') {
        const panel = document.getElementById('adminTrackingPanel');
        panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
      }
    });

    // Admin form submission to issue tracking number
    document.getElementById('adminTrackingForm').addEventListener('submit', async function(e) {
      e.preventDefault();

      const pickup = document.getElementById('adminPickup').value.trim();
      const dropoff = document.getElementById('adminDropoff').value.trim();
      const weight = parseFloat(document.getElementById('adminWeight').value);

      if (!pickup || !dropoff || isNaN(weight)) {
        document.getElementById('adminResponse').textContent = 'Please fill all fields correctly.';
        return;
      }

      try {
        const response = await fetch('https://iship-backend.onrender.com/api/create', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ pickup, dropoff, weight }),
        });

        const data = await response.json();

        if (response.ok) {
          document.getElementById('adminResponse').style.color = 'green';
          document.getElementById('adminResponse').textContent = `Tracking number created: ${data.trackingId}`;
          this.reset();
        } else {
          document.getElementById('adminResponse').style.color = 'red';
          document.getElementById('adminResponse').textContent = `Error: ${data.error || 'Unknown error'}`;
        }
      } catch (err) {
        document.getElementById('adminResponse').style.color = 'red';
        document.getElementById('adminResponse').textContent = `Fetch error: ${err.message}`;
      }
    });

    // Function to track package from user input
    async function trackPackage() {
      const trackingId = document.getElementById('tracking_id').value.trim().toUpperCase();
      if (!trackingId) {
        alert('Please enter a Tracking ID.');
        return;
      }

      try {
        const response = await fetch(`https://iship-backend.onrender.com/api/track/${trackingId}`);
        const data = await response.json();

        const resultDiv = document.getElementById('trackingResult');
        if (response.ok) {
          resultDiv.style.color = 'black';
          resultDiv.innerHTML = `
            <strong>Status for ${trackingId}:</strong><br />
            Pickup: ${data.pickup}<br />
            Drop-off: ${data.dropoff}<br />
            Weight: ${data.weight} kg<br />
            Current Status: ${data.status}<br />
            Last Updated: ${new Date(data.lastUpdated).toLocaleString()}
          `;
        } else {
          resultDiv.style.color = 'red';
          resultDiv.textContent = data.error || 'Tracking ID not found.';
        }
      } catch (err) {
        alert('Error fetching tracking info: ' + err.message);
      }
    }
  </script>
</body>
</html>
